{
    "variables": {
        "memory": "2028",
        "cpus": "2",
        "disk": "40960",
        "vm_name": "win2016tmpl-{{timestamp}}",
        "network": "VM Network",
        "winrm_name": "runner",
        "winrm_pass": "runner",
        "esxi_user": "{{env `ESXI_CREDS_USR`}}",
        "esxi_pass": "{{env `ESXI_CREDS_PSW`}}",
        "esxi_host": "{{env `ESXI_HOST`}}",
        "dvportgroupid": "{{env `DVPORTGROUP_ID`}}",
        "switchid": "{{env `SWITCH_ID`}}",
        "datastore": "{{env `DATASTORE`}}",
        "iso_url": "http://artifactory01.tstdmn.dk:8081/artifactory/generic-local/SVR2016.ENU.APR2017.iso",
        "iso_md5": "af06b895ec08ac6b9f3c1c5c851befa0"
    },
    "builders": [{
        "type": "vmware-iso",
        "output_directory": "{{user `vm_name`}}",
        "vm_name": "{{user `vm_name`}}",
        "communicator": "winrm",
        "winrm_username": "{{user `winrm_name`}}",
        "winrm_password": "{{user `winrm_pass`}}",
        "winrm_timeout": "12h",
        "shutdown_timeout": "15m",
        "keep_registered": true,
        "vnc_disable_password": true,
        "vnc_port_min": "5900",
        "vnc_port_max": "5911",
        "vnc_bind_address": "0.0.0.0",
        "remote_type": "esx5",
        "remote_host": "{{user `esxi_host`}}",
        "remote_username": "{{user `esxi_user`}}",
        "remote_password": "{{user `esxi_pass`}}",
        "remote_datastore": "{{user `datastore`}}",
        "remote_cache_datastore": "{{user `datastore`}}",
        "remote_cache_directory": "packer-cache",
        "iso_url": "{{user `iso_url`}}",
        "iso_checksum": "{{user `iso_md5`}}",
        "iso_checksum_type": "md5",
        "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
        "guest_os_type": "windows9srv-64",
        "tools_upload_flavor": "windows",
        "disk_size" : "{{user `disk`}}",
        "disk_type_id": "thin",
        "http_directory" : "http",
        "http_port_min" : 9010,
        "http_port_max" : 9020,
        "boot_wait": "2m",
        "floppy_files": [
            "answer_files/2016/Autounattend.xml",
            "scripts/winrm.ps1"
        ],
        "vmx_data": {
          "memsize": "{{user `memory`}}",
          "numvcpus": "{{user `cpus`}}",
          "virtualhw.version": "13",
          "scsi0.virtualDev": "lsisas1068",
          "ethernet0.dvs.portgroupid": "{{user `dvportgroupid`}}",
          "ethernet0.dvs.switchid": "{{user `switchid`}}"
        }
    }]
}
